<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=ABeeZee|Abel|Aclonica|Acme|Actor|Advent+Pro|Alata|Alatsi|Aldrich|Alef|Alegreya+Sans|Alegreya+Sans+SC|Allerta|Allerta+Stencil|Almarai|Amaranth|Amiko|Anaheim|Andika|Andika+New+Basic|Antic|Anton|Archivo|Archivo+Black|Archivo+Narrow|Arimo|Armata|Arsenal|Arya|Asap|Asap+Condensed|Assistant|Asul|Athiti|Average+Sans|B612|Bai+Jamjuree|Barlow|Barlow+Condensed|Barlow+Semi+Condensed|Basic|Be+Vietnam|Belleza|BenchNine|Biryani|Black+And+White+Picture|Black+Han+Sans|Blinker|Bubbler+One|Cabin|Cabin+Condensed|Cagliostro|Cairo|Cambay|Candal|Cantarell|Cantora+One|Capriola|Carme|Carrois+Gothic|Carrois+Gothic+SC|Catamaran|Chakra+Petch|Changa|Chathura|Chau+Philomene+One|Chivo|Coda+Caption|Commissioner|Convergence|Cuprum|DM+Sans|Darker+Grotesque|Days+One|Denk+One|Dhurjati|Didact+Gothic|Do+Hyeon|Doppio+One|Dorsa|Dosis|Duru+Sans|Economica|El+Messiri|Electrolize|Encode+Sans|Encode+Sans+Condensed|Encode+Sans+Expanded|Encode+Sans+Semi+Condensed|Encode+Sans+Semi+Expanded|Englebert|Epilogue|Exo|Exo+2|Fahkwang|Farro|Federo|Fira+Sans|Fira+Sans+Condensed|Fira+Sans+Extra+Condensed|Fjalla+One|Francois+One|Fresca|GFS+Neohellenic|Gafata|Galdeano|Gayathri|Geo|Gidugu|Gothic+A1|Gotu|Gudea|Hammersmith+One|Harmattan|Heebo|Hind|Hind+Guntur|Hind+Madurai|Hind+Siliguri|Hind+Vadodara|Homenaje|IBM+Plex+Sans|IBM+Plex+Sans+Condensed|Imprima|Inder|Inria+Sans|Inter|Istok+Web|Jaldi|Jockey+One|Josefin+Sans|Jost|Jua|Julius+Sans+One|Jura|K2D|Kanit|Kantumruy|Karla|Khand|Khula|Kite+One|KoHo|Kodchasan|Kosugi|Kosugi+Maru|Krona+One|Krub|Kulim+Park|Kumbh+Sans|Lato|Lekton|Lexend+Deca|Lexend+Exa|Lexend+Giga|Lexend+Mega|Lexend+Peta|Lexend+Tera|Lexend+Zetta|Libre+Franklin|Livvic|M+PLUS+1p|M+PLUS+Rounded+1c|Mada|Magra|Mako|Mallanna|Mandali|Manjari|Manrope|Marmelad|Martel+Sans|Marvel|Maven+Pro|Meera+Inimai|Merriweather+Sans|Metrophobic|Michroma|Mina|Miriam+Libre|Mitr|Molengo|Monda|Montserrat|Montserrat+Alternates|Montserrat+Subrayada|Mouse+Memoirs|Mukta|Mukta+Mahee|Mukta+Malar|Mukta+Vaani|Mulish|NTR|Nanum+Gothic|News+Cycle|Niramit|Nobile|Notable|Noto+Sans|Noto+Sans+HK|Noto+Sans+JP|Noto+Sans+KR|Noto+Sans+SC|Noto+Sans+TC|Numans|Nunito|Nunito+Sans|Open+Sans|Open+Sans+Condensed|Orbitron|Orienta|Oswald|Overpass|Oxygen|PT+Sans|PT+Sans+Caption|PT+Sans+Narrow|Padauk|Palanquin|Palanquin+Dark|Pathway+Gothic+One|Pattaya|Pavanam|Paytone+One|Philosopher|Play|Pontano+Sans|Poppins|Port+Lligat+Sans|Pragati+Narrow|Prompt|Proza+Libre|Public+Sans|Puritan|Quantico|Quattrocento+Sans|Questrial|Quicksand|Rajdhani|Raleway|Ramabhadra|Rambla|Rationale|Recursive|Red+Hat+Display|Red+Hat+Text|Reem+Kufi|Roboto|Roboto+Condensed|Ropa+Sans|Rosario|Rubik|Rubik+Mono+One|Ruda|Ruluko|Rum+Raisin|Russo+One|Saira|Saira+Condensed|Saira+Extra+Condensed|Saira+Semi+Condensed|Sansita|Sarabun|Sarala|Sarpanch|Sawarabi+Gothic|Sawarabi+Mincho|Scada|Secular+One|Sen|Seymour+One|Shanti|Share+Tech|Signika|Signika+Negative|Sintony|Six+Caps|Snippet|Sora|Source+Sans+Pro|Space+Grotesk|Spartan|Spinnaker|Strait|Stylish|Sulphur+Point|Sunflower|Syncopate|Syne|Tajawal|Tauri|Teko|Telex|Tenali+Ramakrishna|Tenor+Sans|Text+Me+One|Thasadith|Timmana|Titillium+Web|Tomorrow|Trispace|Ubuntu|Ubuntu+Condensed|Varela|Varela+Round|Varta|Viga|Voltaire|Wendy+One|Wire+One|Work+Sans|Yanone+Kaffeesatz|Yantramanav">
  
  <link rel="stylesheet" type="text/css" href="https://specials.manoramaonline.com/Common/mm-fonts/css/mmfonts2.css">
  <style>
        /* CRITICAL FIX: Hide the native MoEngage close button (we click it via JS) */
        .moe-inapp-close {
            display: none !important;
        }
       body
        {
            background: url('https://cdn.botb.com/media/kk5hxws3/desktop.png');
        }

        /* --- SPIN WIDGET STYLES --- */
        .spin-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 2147483647; 
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
      
            pointer-events: none; 
            font-family: 'Arial', sans-serif;
               flex-direction: column;
        }

        .spin-overlay.is-visible {
            opacity: 1;
            visibility: visible;
        }

        .widget-card {
            pointer-events: auto; 
            position: relative;
            width: 90%;
            max-width: 340px;
            background: #ffffff;
            border-radius: 20px;
            padding: 20px 15px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4); 
            border: 1px solid #eee;
            background: url('https://i.postimg.cc/1XHtgKJx/3806211-3552-Converted.jpg');
            background-size: cover;
            font-family: 'poppins';
         
        }

        .close-widget-btn {
    border-radius: 50%;
    position: absolute;
    top: 8px;
    right: 12px;
    background: none;
    border: none;
    font-size: 24px;
    color: #9d9d9d;
    cursor: pointer;
    z-index: 10;
    background: #fffffffc;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
        }

        .widget-title {
            color: #ffbf00; margin: 0 0 15px 0;
            font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
        }

        .input-area { margin-bottom: 15px; }

        #mobileInput {
        width: 80%;
    padding: 9px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 14px;
    text-align: center;
    outline: none;
    background: #f9f9f9;
    font-family: 'poppins';
    font-weight: 500;
        }
        #mobileInput:focus { border-color: #ff4757; background: #fff; }

        .wheel-stage {
            position: relative;
            width: 240px; height: 240px;
            margin: 0 auto 20px auto;
        }

        canvas {
            width: 100%; height: 100%;
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            transition: transform 3s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        .wheel-marker {
            position: absolute;
            top: -8px; left: 50%;
            transform: translateX(-50%);
            width: 0; height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-top: 20px solid #ff4757;
            z-index: 5;
        }

        .action-btn {
            background: #ff8000; color: white;
            border: none; padding: 12px 40px;
            font-size: 16px; font-weight: bold;
            border-radius: 30px; cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
        }
        .action-btn:disabled { background: #ddd; box-shadow: none; cursor: not-allowed; color: #888; }

        .result-layer {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(255,255,255,0.98);
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none;
            transition: opacity 0.5s;
            z-index: 20; border-radius: 20px;
            flex-direction: column;
                      background: url('https://i.postimg.cc/1XHtgKJx/3806211-3552-Converted.jpg');
                      background-size: cover;
                          background-position: center;
        }
        .result-layer.show { opacity: 1; pointer-events: all; }
        .result-content h3 { margin: 0; color: #FFEB3B; }
        .prize-display { 

    font-size: 29px;
    font-weight: 900;
    color: #ff4757;
    margin: 10px 0;
    background: #ffffff;
    /* padding: 10px 20px; */
    border-radius: 14px;
    blur: 1px 2px #ccc;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    background: url('https://i.postimg.cc/pX37h51K/Vector.png');
    background-size: 96%;
    background-position: center;
    background-repeat: no-repeat;
    overflow: visible;
    height: 102px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 160px;
        }
        .coupon-box {
            background: #f1f2f6; border: 2px dashed #ff4757;
            padding: 8px 15px; font-family: monospace; font-size: 18px; font-weight: bold;
            margin: 10px auto; width: fit-content;
        }
        .cta-link {
            display: inline-block; background: #ffbf00; color: white; text-decoration: none;
            padding: 10px 25px; border-radius: 5px; font-weight: bold; margin-top: 10px;
        }
        .close-text-btn {
    background: none;
    border: none;
    text-decoration: underline;
    color: #ffffff;
    margin-top: 10px;
    cursor: pointer;
    font-size: 18px;
        }
    </style>
</head>

<body data-template-type="SIDE_BANNER">



    
    <button data-id="CLOSE" type="button" class="close-icon moe-inapp-close moe-element" aria-label="Close" id="close-icon"> x </button>

    <div id="spin-widget-overlay" class="spin-overlay">

        
    <!-- <p>Welcome to Our Rewards Zone</p> -->
        <div class="widget-card">
            <button class="close-widget-btn" onclick="closeSpinWidget()">Ã—</button>
            <h2 class="widget-title">Spin & Win!</h2>
            <div class="input-area">
                <input type="tel" id="mobileInput" placeholder="Enter Mobile Number" maxlength="10">
            </div>
            <div class="wheel-stage">
                <div class="wheel-marker"></div>
                <canvas id="wheelCanvas" width="400" height="400"></canvas>
            </div>
            <button id="spinBtn" class="action-btn" disabled>SPIN NOW</button>
            <div class="result-layer" id="resultLayer">
                <div class="result-content">
                    <h3>You Won!</h3>
                    <div class="prize-display" id="prizeText">20% OFF</div>
                    <p style="color: #fff;">Use Coupon Code:</p>
                    <div class="coupon-box" id="couponCode">CODE20</div>
                    <a href="https://yourwebsite.com/redeem" class="cta-link" target="_blank">Redeem Now</a>
                    <br>
                    <button class="close-text-btn" onclick="closeSpinWidget()">Close</button>
                </div>
            </div>
        </div>
    </div>


<audio id="spinSound" preload="auto">
    <source src="https://assets.manoramahorizon.com/uploads/media/2026/01/website/drums.mp3" type="audio/mpeg">
</audio>

<audio id="winSound" preload="auto">
  <source src="https://assets.manoramahorizon.com/uploads/media/2026/01/website/clap.wav" type="audio/mpeg">
</audio>

    <script>
        (function() {
            const prizes = [
                { text: "10% OFF", color: "#7F42B0", code: "SAVE10" },
                { text: "No Luck", color: "#b2bec3", code: null },
                { text: "Free Ship", color: "#008F97", code: "FREESHIP" },
                { text: "500 Pts", color: "#F2A107", code: "PTS500" },
                { text: "Jackpot", color: "#F10C57", code: "JACKPOT" },
                { text: "20% OFF", color: "#00D777", code: "SAVE20" }
            ];

            // --- TELEPORT LOGIC ---
            const overlay = document.getElementById('spin-widget-overlay');
            if (overlay && document.body) {
                document.body.appendChild(overlay);
            }

            const canvas = document.getElementById('wheelCanvas');
            const ctx = canvas.getContext('2d');
            const spinBtn = document.getElementById('spinBtn');
            const mobileInput = document.getElementById('mobileInput');
            const resultLayer = document.getElementById('resultLayer');
            const prizeDisplay = document.getElementById('prizeText');
            const couponDisplay = document.getElementById('couponCode');
            
            let currentRotation = 0;
            let isSpinning = false;
            const arcSize = (2 * Math.PI) / prizes.length;

            function drawWheel() {
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = canvas.width / 2;

                prizes.forEach((prize, i) => {
                    const angle = i * arcSize;
                    ctx.beginPath();
                    ctx.fillStyle = prize.color;
                    ctx.moveTo(centerX, centerY);
                    ctx.arc(centerX, centerY, radius, angle, angle + arcSize);
                    ctx.lineTo(centerX, centerY);
                    ctx.fill();

                    ctx.save();
                    ctx.translate(centerX, centerY);
                    ctx.rotate(angle + arcSize / 2);
                    ctx.textAlign = "right";
                    ctx.fillStyle = "#fff";
                    ctx.font = "bold 24px Arial";
                    ctx.fillText(prize.text, radius - 30, 10);
                    ctx.restore();
                });
            }

            drawWheel();

            mobileInput.addEventListener('input', (e) => {
                const val = e.target.value.replace(/\D/g, '');
                e.target.value = val;
                spinBtn.disabled = val.length < 10;
            });

            spinBtn.addEventListener('click', () => {
                if (isSpinning) return;

                // ðŸ”Š Play spin sound
                const spinSound = document.getElementById("spinSound");
                spinSound.currentTime = 0;
                spinSound.play();   

                isSpinning = true;
                spinBtn.innerText = "Spinning...";
                
                const spins = 5; 
                const randomDegree = Math.floor(Math.random() * 360); 
                const totalDegrees = (spins * 360) + randomDegree;
                currentRotation += totalDegrees;
                
                canvas.style.transform = `rotate(-${currentRotation}deg)`;


                setTimeout(() => {

    // Stop spin sound
    spinSound.pause();
    spinSound.currentTime = 0;

    // Get winning prize correctly
    const prize = calculateWinner(currentRotation);

    // ðŸŽ‰ ONLY if user wins
// ðŸŽ‰ ONLY if user wins
if (prize.text !== "No Luck") {

    // Confetti
    launchConfetti();

    // Win sound
    const winSound = document.getElementById("winSound");
    winSound.currentTime = 0;
    winSound.play();

    // ðŸ”‡ Auto-stop win sound after 4 seconds
    setTimeout(() => {
        winSound.pause();
        winSound.currentTime = 0;
    }, 4000);
}


    // Show result
    showResult(prize);

    spinBtn.innerText = "SPIN NOW";
    isSpinning = false;

}, 3000);



            });

       function calculateWinner(rotation) {
    const degreesPerSlice = 360 / prizes.length;
    const index = Math.floor(((rotation + 90) % 360) / degreesPerSlice);
    const winningIndex = (prizes.length - 1 - index + prizes.length) % prizes.length;

    return prizes[winningIndex];
}


            function showResult(prize) {
                prizeDisplay.innerText = prize.text;
                prizeDisplay.style.color = prize.color;
                if(prize.code) {
                    couponDisplay.style.display = 'block';
                    couponDisplay.innerText = prize.code;
                } else {
                    couponDisplay.style.display = 'none';
                }
                resultLayer.classList.add('show');
            }

            // --- CLOSING LOGIC (UPDATED) ---
            window.closeSpinWidget = function() {
                // 1. Hide our widget
                overlay.classList.remove('is-visible');
                
                // 2. Find the hidden native MoEngage close button and click it
                // This forces MoEngage to close the entire campaign overlay
                const moeCloseBtn = document.querySelector('.moe-inapp-close');
                if (moeCloseBtn) {
                    moeCloseBtn.click();
                } else {
                    console.log("MoEngage close button not found - manually hiding");
                    // Fallback: try to hide the parent frame if accessible
                    if (window.frameElement) {
                        window.frameElement.style.display = 'none';
                    }
                }
            };
            
            window.openSpinWidget = function() {
                overlay.classList.add('is-visible');
            };

            setTimeout(window.openSpinWidget, 1000);

        })();





function launchConfetti() {
    const duration = 1800;
    const end = Date.now() + duration;

    (function frame() {
        confetti({
            particleCount: 7,
            angle: 60,
            spread: 70,
            origin: { x: 0 }
        });
        confetti({
            particleCount: 7,
            angle: 120,
            spread: 70,
            origin: { x: 1 }
        });

        if (Date.now() < end) {
            requestAnimationFrame(frame);
        }
    })();
}


    </script>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

</body>
</html>